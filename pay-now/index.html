<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Secure Payment</title>
  <style>
    body {
      margin:0;
      padding:150px 20px;
      font-family:"Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background:linear-gradient(135deg, #0a2647, #144272);
      color:white;
      display:flex;
      justify-content:center;
      align-items:flex-start;
    }
    .card {
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(10px);
      padding:40px;
      border-radius:20px;
      text-align:center;
      box-shadow:0 8px 25px rgba(0,0,0,0.3);
      max-width:450px;
      width:100%;
      animation:fadeInUp 0.8s ease forwards;
      position:relative;
    }
    h1 { font-size:2rem; margin-bottom:20px; }
    p { font-size:1rem; margin-bottom:15px; }
    input, select { width:100%; padding:14px; border-radius:8px; border:none; margin-bottom:20px; font-size:1rem; }
    button {
      padding:14px 28px;
      font-size:1rem;
      font-weight:bold;
      border:none;
      border-radius:10px;
      background:#ff6b35;
      color:white;
      cursor:pointer;
      transition:all 0.3s ease;
    }
    button:hover {
      background:#ff834f;
      transform:translateY(-3px);
      box-shadow:0 8px 20px rgba(255,107,53,0.6);
    }
    @keyframes fadeInUp { from { opacity:0; transform:translateY(40px); } to { opacity:1; transform:translateY(0); } }
    .loader { border:6px solid rgba(255,255,255,0.2); border-top:6px solid #ff6b35; border-radius:50%; width:60px; height:60px; margin:20px auto; animation:spin 1s linear infinite; display:none;}
    @keyframes spin { from { transform:rotate(0deg); } to { transform:rotate(360deg); } }
    .message { margin-top:20px; font-size:1rem; }
  </style>
</head>
<body>
  <div class="card" id="paymentCard">
    <h1>Complete Your Payment</h1>
    <p>Enter your email:</p>
    <input type="email" id="email" placeholder="you@example.com">
    <p>Select package:</p>
    <select id="package">
      <option value="basic">Basic - GHS 200</option>
      <option value="standard">Standard - GHS 500</option>
      <option value="premium">Premium - GHS 1200</option>
      <option value="consultation">Consultation - Min GHS 99</option>
    </select>
    <button onclick="startPayment()">Pay Now</button>
    <div class="loader" id="loader"></div>
    <div class="message" id="message"></div>
  </div>


<!-- Paystack inline JS -->
  <script src="https://js.paystack.co/v1/inline.js"></script>
  <script>
    function startPayment() {
      const email = document.getElementById("email").value.trim();
      const paymentType = document.getElementById("package").value;
      const loader = document.getElementById("loader");
      const messageDiv = document.getElementById("message");

      messageDiv.innerHTML = "";

      if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        messageDiv.innerHTML = "<strong style='color:red;'>Please enter a valid email.</strong>";
        return;
      }

      let amountGHS;
      if (paymentType === "basic") amountGHS = 200;
      else if (paymentType === "standard") amountGHS = 500;
      else if (paymentType === "premium") amountGHS = 1200;
      else if (paymentType === "consultation") amountGHS = 99;
      else { 
        messageDiv.innerHTML = "<strong style='color:red;'>Unknown package selected.</strong>"; 
        return; 
      }

      loader.style.display = "block";
      messageDiv.innerText = "";

      let handler = PaystackPop.setup({
        key: "pk_test_16564cc148fd3ced63b191c4690e420f11d3278c",
        email: email,
        amount: amountGHS * 100,
        currency: "GHS",
        ref: '' + Math.floor(Math.random() * 1000000000 + 1),
        metadata: {
          custom_fields: [
            {
              display_name: "Package",
              variable_name: "package",
              value: paymentType
            }
          ]
        },

        callback: function(response) {
          loader.style.display = "block";
          messageDiv.innerText = "Processing your payment...";

          setTimeout(() => {
            try {
              handler.close(); // ✅ close Paystack iframe
            } catch (e) {
              console.warn("Paystack iframe already closed:", e);
            }

            // ✅ redirect from your own page (not sandbox)
            window.location.href = `https://pay.dataversegh.com/payment-success?reference=${response.reference}`;
          }, 1500);
        },

        onClose: function() {
          loader.style.display = "none";
          messageDiv.innerHTML = "<strong>Payment window closed.</strong>";
        }
      });

      handler.openIframe();
    }
  </script>
</body>
</html>
